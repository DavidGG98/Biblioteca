-- --------------------------------------------------------
-- Host:                         127.0.0.1
-- Versión del servidor:         8.0.19 - MySQL Community Server - GPL
-- SO del servidor:              Win64
-- HeidiSQL Versión:             10.3.0.5771
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;


-- Volcando estructura de base de datos para bibliotecas
CREATE DATABASE IF NOT EXISTS `bibliotecas` /*!40100 DEFAULT CHARACTER SET utf8 */ /*!80016 DEFAULT ENCRYPTION='N' */;
USE `bibliotecas`;

-- Volcando estructura para tabla bibliotecas.autores
CREATE TABLE IF NOT EXISTS `autores` (
  `IdAutor` int NOT NULL AUTO_INCREMENT,
  `Nombre` varchar(30) NOT NULL,
  `Apellidos` varchar(50) DEFAULT NULL,
  `Nacionalidad` varchar(50) DEFAULT NULL,
  `FechaNacimiento` date DEFAULT NULL,
  PRIMARY KEY (`IdAutor`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.bibliotecas
CREATE TABLE IF NOT EXISTS `bibliotecas` (
  `IdBiblioteca` int NOT NULL AUTO_INCREMENT,
  `NombreBiblio` varchar(50) NOT NULL,
  `Direccion` varchar(100) NOT NULL,
  `Localidad` varchar(50) NOT NULL,
  PRIMARY KEY (`IdBiblioteca`),
  UNIQUE KEY `Direccion` (`Direccion`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.editoriales
CREATE TABLE IF NOT EXISTS `editoriales` (
  `IdEditorial` int NOT NULL AUTO_INCREMENT,
  `Nombre` varchar(50) NOT NULL DEFAULT '',
  `Telefono` varchar(15) DEFAULT NULL,
  `Email` varchar(50) DEFAULT NULL,
  `CIF` varchar(10) NOT NULL DEFAULT '',
  PRIMARY KEY (`IdEditorial`),
  UNIQUE KEY `Nombre` (`Nombre`),
  UNIQUE KEY `CIF` (`CIF`),
  UNIQUE KEY `Email` (`Email`),
  UNIQUE KEY `Telefono` (`Telefono`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.libros
CREATE TABLE IF NOT EXISTS `libros` (
  `IdLibro` INT NOT NULL AUTO_INCREMENT,
	`Titulo` VARCHAR(50) NOT NULL,
	`Genero` VARCHAR(20) NULL DEFAULT NULL,
	`Resumen` VARCHAR(500) NULL DEFAULT NULL,
	`Imagen` VARCHAR(100) NULL DEFAULT NULL,
	`TiempoPrestamo` INT NOT NULL DEFAULT '30',
	`Idioma` VARCHAR(50) NOT NULL DEFAULT 'Español',
	`IdAutor` INT NOT NULL,
	`IdBiblioteca` INT NOT NULL,
	`IdEditorial` INT NOT NULL,
	PRIMARY KEY (`IdLibro`),
	INDEX `autor` (`IdAutor`),
	INDEX `biblioteca` (`IdBiblioteca`),
	INDEX `editorial` (`IdEditorial`),
	CONSTRAINT `autor` FOREIGN KEY (`IdAutor`) REFERENCES `autores` (`IdAutor`) ON UPDATE CASCADE,
	CONSTRAINT `biblioteca` FOREIGN KEY (`IdBiblioteca`) REFERENCES `bibliotecas` (`IdBiblioteca`) ON UPDATE CASCADE,
  	CONSTRAINT `editorial` FOREIGN KEY (`IdEditorial`) REFERENCES `editoriales` (`IdEditorial`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.prestamos
CREATE TABLE IF NOT EXISTS `prestamos` (
	`IdPrestamo` INT NOT NULL AUTO_INCREMENT,
	`IdLibro` INT NOT NULL,
	`IdUsuario` INT NOT NULL,
	`FechaInicio` DATE NOT NULL,
	`FechaFin` DATE NOT NULL,
	`FechaDevolucion` DATE NULL DEFAULT NULL,
	PRIMARY KEY (`IdPrestamo`),
	INDEX `libro` (`IdLibro`),
	INDEX `usuario` (`IdUsuario`),
	CONSTRAINT `libro` FOREIGN KEY (`IdLibro`) REFERENCES `libros` (`IdLibro`) ON UPDATE CASCADE,
	CONSTRAINT `usuario` FOREIGN KEY (`IdUsuario`) REFERENCES `usuarios` (`IdUsuario`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.roles
CREATE TABLE IF NOT EXISTS `roles` (
  `IdRol` int NOT NULL AUTO_INCREMENT,
  `Descripcion` varchar(50) DEFAULT NULL,
  `Nombre` varchar(50) NOT NULL,
  PRIMARY KEY (`IdRol`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.trabajadores
CREATE TABLE IF NOT EXISTS `trabajadores` (
  `IdTrabajador` int NOT NULL AUTO_INCREMENT,
  `Contrasena` varchar(20) NOT NULL,
  `Nombre` varchar(20) NOT NULL,
  `Apellidos` varchar(50) NOT NULL,
  `DNI` varchar(9) NOT NULL,
  `IdBiblioteca` int NOT NULL,
  `IdRol` int NOT NULL,
  PRIMARY KEY (`IdTrabajador`),
  KEY `bibliotecaTrabajador` (`IdBiblioteca`),
  KEY `rol` (`IdRol`),
  CONSTRAINT `bibliotecaTrabajador` FOREIGN KEY (`IdBiblioteca`) REFERENCES `bibliotecas` (`IdBiblioteca`) ON UPDATE CASCADE,
  CONSTRAINT `rol` FOREIGN KEY (`IdRol`) REFERENCES `roles` (`IdRol`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- La exportación de datos fue deseleccionada.

-- Volcando estructura para tabla bibliotecas.usuarios
CREATE TABLE IF NOT EXISTS `usuarios` (
  `IdUsuario` int NOT NULL AUTO_INCREMENT,
  `Nombre` varchar(50) NOT NULL,
  `Apellidos` varchar(50) NOT NULL,
  `Contraseña` varchar(20) NOT NULL,
  `NumeroCarnet` varchar(10) NOT NULL,
  `Email` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`IdUsuario`),
  UNIQUE KEY `NumeroCarnet` (`NumeroCarnet`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- La exportación de datos fue deseleccionada.

/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
